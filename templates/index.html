<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>TikTok Smart Cut ‚Ä¢ Hotel Reels</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/static/css/style.css" />
    <script src="/static/js/app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4/dist/js-yaml.min.js"></script>

</head>

<body>
    <div class="app-shell">
        <!-- HEADER -->
        <header class="app-header">
            <div class="brand">
                <div class="brand-logo">TS</div>
                <div class="brand-text">
                    <h1>TikTok Smart Cut</h1>
                    <p>Hotel & travel reels, on autopilot.</p>
                </div>
            </div>

            <div class="header-meta">
                <span class="tag">Dark Studio Mode</span>
                <span class="tag tag-outline">Powered by OpenAI</span>
            </div>
        </header>

        <!-- STEPPER NAV -->
        <nav class="stepper">
            <button class="step active" data-target="#step-1">
                <span class="step-index">1</span>
                <span class="step-label">Upload & Analyze</span>
            </button>

            <button class="step" data-target="#step-2">
                <span class="step-index">2</span>
                <span class="step-label">Storyboard YAML</span>
            </button>

            <button class="step" data-target="#step-3">
                <span class="step-index">3</span>
                <span class="step-label">Captions</span>
            </button>

            <button class="step" data-target="#step-4">
                <span class="step-index">4</span>
                <span class="step-label">Style & Timing</span>
            </button>

            <button class="step" data-target="#step-5">
                <span class="step-index">5</span>
                <span class="step-label">Export & Download</span>
            </button>
        </nav>

        <!-- MAIN GRID -->
        <main class="layout">

            <!-- LEFT MAIN COLUMN -->
            <section class="main-column">

                <!-- STEP 1 -->
                <section class="card step-card" id="step-1">
                    <div class="card-header">
                        <h2>Step 1 ¬∑ Upload & Analyze Clips</h2>
                        <p class="card-subtitle">
                            Upload from your device to <code>raw_uploads/</code> in S3, then auto-generate hotel-style descriptions for each clip.
                        </p>
                    </div>

                    <div class="card-body">

                        <!-- Upload -->
                        <div class="card-subsection">
                            <h3>Upload to S3</h3>
                            <p class="hint-text">
                                Drag & drop hotel clips, or click to browse. Files will upload to <code>raw_uploads/</code>.
                            </p>

                            <div id="dropZone" class="upload-dropzone">
                                <p>üìÇ Drop videos here or click to browse</p>
                                <input id="uploadFiles" type="file" multiple hidden />
                            </div>

                            <button id="uploadBtn" class="btn secondary" disabled>‚¨Ü Upload</button>
                            <div id="uploadPreview" class="upload-preview"></div>

                            <div id="uploadProgressWrapper" class="progress-wrapper hidden">
                                <div id="uploadProgress" class="progress-bar"></div>
                            </div>

                            <div id="uploadStatus" class="hint-text"></div>
                        </div>

                        <hr class="divider" />

                        <!-- Analyze -->
                        <div class="row">
                            <button id="analyzeBtn" class="btn primary">üîç Analyze clips from S3</button>
                            <button id="refreshAnalysesBtn" class="btn ghost">‚Üª Refresh analyses</button>
                        </div>
                        <div id="analyzeStatus" class="hint-text"></div>

                        <!-- Analysis List -->
                        <div class="card-subsection">
                            <h3>Detected Clips & Analyses</h3>
                            <p class="hint-text">Generated by the LLM. Used for hooks, captions, and storyboards.</p>
                            <ul id="analysesList" class="analysis-list"></ul>
                        </div>

                    </div>
                </section>

                <!-- STEP 2 -->
                <section class="card step-card" id="step-2">
                    <div class="card-header">
                        <h2>Step 2 ¬∑ Generate Storyboard YAML</h2>
                        <p class="card-subtitle">
                            Build <code>config.yml</code> for your reel: clips, text, timing, overlay, CTA, render settings.
                        </p>
                    </div>

                    <div class="card-body">

                        <div class="row">
                            <button id="generateYamlBtn" class="btn primary">üìÑ Generate YAML from analyses</button>
                            <button id="refreshYamlBtn" class="btn ghost">‚Üª Reload YAML</button>
                        </div>
                        <div id="yamlStatus" class="hint-text"></div>

                        <div class="split">
                            <!-- YAML editor -->
                            <div class="split-panel">
                                <label class="field-label">config.yml</label>
                                <textarea id="yamlText" class="textarea code" rows="20"></textarea>

                                <div class="row">
                                    <button id="saveYamlBtn" class="btn secondary">üíæ Save YAML</button>
                                </div>
                            </div>

                            <!-- Parsed Preview -->
                            <div class="split-panel">
                                <h3>Preview (parsed)</h3>
                                <div id="yamlPreview" class="yaml-preview"></div>
                            </div>
                        </div>

                    </div>
                </section>

                <!-- STEP 3 -->
                <section class="card step-card" id="step-3">
                    <div class="card-header">
                        <h2>Step 3 ¬∑ Edit Captions</h2>
                        <p class="card-subtitle">One paragraph per clip. Order: first ‚Üí middle(s) ‚Üí last.</p>
                    </div>

                    <div class="card-body">

                        <div class="row">
                            <button id="loadCaptionsFromYamlBtn" class="btn ghost">‚§µ Load captions from YAML</button>
                        </div>

                        <label class="field-label">Captions</label>
                        <textarea id="captionsText" class="textarea" rows="12"></textarea>

                        <div class="row row-align-center">
                            <button id="saveCaptionsBtn" class="btn secondary">üíæ Save captions</button>
                            <div id="captionsStatus" class="hint-text"></div>
                        </div>

                    </div>
                </section>

                <!-- STEP 4 -->
                <section class="card step-card" id="step-4">
                  <div class="card-header">
                      <h2>Step 4 ¬∑ Style, Voice & Timing</h2>
                      <p class="card-subtitle">Overlay, pacing, voice, CTA, music and scale.</p>
                  </div>

                  <div class="card-body accordion">

                      <!-- 4A ‚Äî Overlay & Timing -->
                      <div class="acc-section">
                          <button class="acc-header">üé® Overlay & Timing</button>
                          <div class="acc-body">

                              <h3>Overlay Style</h3>
                              <label class="field-label">Caption tone</label>
                              <select id="overlayStyle" class="select">
                                <option value="ai_recommended">‚ú® AI Recommended (auto)</option>
                                <option value="travel_blog">Travel blogger</option>
                                <option value="punchy">Punchy & energetic</option>
                                <option value="cinematic">Cinematic & moody</option>
                                <option value="descriptive">Literal & descriptive</option>
                                <option value="influencer">Influencer voice</option>
                            </select>


                              <button id="applyOverlayBtn" class="btn secondary">‚ú® Apply overlay</button>
                              <div id="overlayStatus" class="hint-text"></div>

                              <h3>Timings</h3>
                              <div class="row">
                                  <button id="applyStandardTimingBtn" class="btn ghost">‚è± Standard</button>
                                  <button id="applyCinematicTimingBtn" class="btn ghost">üé¨ Cinematic</button>
                              </div>
                              <div id="timingStatus" class="hint-text"></div>

                          </div>
                      </div>

                      <!-- 4B ‚Äî Voice + CTA -->
                      <div class="acc-section">
                          <button class="acc-header">üé§ Voice (TTS) & CTA</button>
                          <div class="acc-body">

                              <h3>Voice (TTS)</h3>

                              <div class="checkbox-row">
                                  <input type="checkbox" id="ttsEnabled" />
                                  <label for="ttsEnabled">Enable TTS voiceover</label>
                              </div>

                              <label class="field-label">Voice</label>
                              <select id="ttsVoice" class="select">
                                  <option value="alloy">Alloy</option>
                                  <option value="verse">Verse</option>
                                  <option value="ballad">Ballad</option>
                                  <option value="nova">Nova</option>
                                  <option value="shimmer">Shimmer</option>
                                  <option value="coral">Coral</option>
                                  <option value="echo">Echo</option>
                                  <option value="fable">Fable</option>
                                  <option value="onyx">Onyx</option>
                                  <option value="ash">Ash</option>
                                  <option value="sage">Sage</option>
                                  <option value="marin">Marin</option>
                                  <option value="cedar">Cedar</option>
                              </select>

                              <button id="saveTtsBtn" class="btn ghost">üíæ Save TTS</button>

                              <h3>CTA</h3>

                              <div class="checkbox-row">
                                  <input type="checkbox" id="ctaEnabled" />
                                  <label for="ctaEnabled">Enable CTA overlay</label>
                              </div>

                              <label class="field-label">CTA text</label>
                              <input id="ctaText" class="input" placeholder="Tap to book with today‚Äôs deals üîó" />

                              <div class="checkbox-row">
                                  <input type="checkbox" id="ctaVoiceover" />
                                  <label for="ctaVoiceover">Include in voiceover</label>
                              </div>

                              <button id="saveCtaBtn" class="btn ghost">üíæ Save CTA</button>

                          </div>
                      </div>
                      
                      <!-- Choose caption scaling. Classic vs TikTok Look -->
                      <!-- 4D ‚Äî Caption Layout Mode -->
                      <!-- 4D ‚Äî Caption Layout Mode -->
                      <div class="acc-section">
                          <button class="acc-header">üìù Caption Layout</button>
                          <div class="acc-body">

                              <label class="field-label">Choose Caption Style</label>
                              <div class="form-row">
                                  <select id="layoutMode" class="select">
                                      <option value="tiktok">TikTok (recommended)</option>
                                      <option value="classic">Classic (bottom bar style)</option>
                                  </select>

                                  <button id="saveLayoutBtn" class="btn small ghost">üíæ Save</button>
                              </div>

                              <div id="layoutStatus" class="hint-text"></div>

                              <p class="hint">
                                  ‚Ä¢ <b>TikTok</b>: large captions, centered, dynamic wrapping, shadow + box.<br>
                                  ‚Ä¢ <b>Classic</b>: cleaner, smaller, bottom placement.<br>
                                  ‚Ä¢ Saved directly into <code>render.layout_mode</code> in YAML.
                              </p>
                          </div>
                      </div>

                      <!-- 4C ‚Äî Music + FG Scale -->
                      <div class="acc-section">
                          <button class="acc-header">üéµ Music & Foreground Scale</button>
                          <div class="acc-body">

                              <h3>Background Music</h3>

                              <div class="checkbox-row">
                                  <input type="checkbox" id="musicEnabled" />
                                  <label for="musicEnabled">Enable background music</label>
                              </div>

                              <label class="field-label">Music track</label>
                              <select id="musicFile" class="select">
                                  <option value="">‚Äì No music ‚Äì</option>
                              </select>

                              <label class="field-label" style="margin-top:8px;">Volume</label>
                              <input id="musicVolume" type="range" min="0" max="1" step="0.05" value="0.25" />
                              <div class="range-value"><span id="musicVolumeLabel">0.25</span></div>

                              <div class="row">
                                  <button id="saveMusicBtn" class="btn ghost">üíæ Save music</button>
                                  <button id="musicPreviewBtn" class="btn primary">‚ñ∂ Preview</button>
                              </div>
                              <span id="musicPreviewStatus" class="hint-text"></span>

                              <h3>Foreground Scale</h3>
                              <label class="field-label">Default zoom</label>
                              <input id="fgScale" type="range" min="0.8" max="1.3" step="0.05" value="1.0" />
                              <div class="range-value"><span id="fgScaleValue">1.0</span>x</div>

                              <button id="saveFgScaleBtn" class="btn ghost">üíæ Save scale</button>

                          </div>
                      </div>

                      <div id="styleStatus" class="hint-text"></div>

                  </div>
              </section>

                <!-- STEP 5 -->
                <section class="card step-card" id="step-5">
                    <div class="card-header">
                        <h2>Step 5 ¬∑ Export & Download</h2>
                        <p class="card-subtitle">Render final vertical MP4 with music, captions, TTS, CTA.</p>
                    </div>

                    <div class="card-body">

                        <h3>Render Mode</h3>

                        <div id="exportModeContainer" class="row radio-row render-controls">
                            <label class="radio">
                                <input type="radio" name="exportMode" value="standard" checked />
                                <span>Standard (fast)</span>
                            </label>

                            <label class="radio">
                                <input type="radio" name="exportMode" value="optimized" />
                                <span>Optimized (HQ)</span>
                            </label>
                        </div>

                        <button id="exportBtn" class="btn primary">üé• Render & Export</button>
                        <div id="exportStatus" class="hint-text"></div>

                        <div id="downloadArea" class="download-area"></div>
                    </div>

                </section>

            </section>

            <!-- RIGHT SIDEBAR -->
            <aside class="side-column">

                <!-- Live Log -->
                <section class="card log-card">
                    <div class="card-header">
                        <h2>Live Log</h2>
                        <p class="card-subtitle">
                            Shows all backend actions: S3, ffmpeg, LLM, export.
                        </p>
                    </div>
                    <div class="card-body">
                        <pre id="statusLog" class="log-view"></pre>
                    </div>
                </section>

                <!-- Chat Assistant -->
                <section class="card chat-card">
                    <div class="card-header">
                        <h2>Creative Assistant</h2>
                        <p class="card-subtitle">
                            Ask for hooks, thumbnails, storylines, or caption alternatives.
                        </p>
                    </div>

                    <div class="card-body">
                        <textarea
                            id="chatInput"
                            class="textarea"
                            rows="3"
                            placeholder="E.g. 'Give me 3 hook ideas for these clips focusing on the rooftop pool.'"
                        ></textarea>
                        <button id="chatSendBtn" class="btn secondary full">üí¨ Ask the assistant</button>

                        <div id="chatOutput" class="chat-output"></div>
                    </div>
                </section>

            </aside>

        </main>
    </div>

</body>
</html>
